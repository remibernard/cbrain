
<%-
#
# CBRAIN Project
#
# Copyright (C) 2008-2012
# The Royal Institution for the Advancement of Learning
# McGill University
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
-%>

<% if @userfile.is_locally_synced? && @userfile.respond_to?(:cache_full_path) %>
  <% if @page_type != :show || (@userfile.size || 999_999) < 1000 %>
    <% content = File.read(@userfile.cache_full_path) rescue nil %>
    <% content = content.text_file_content_to_utf8 if content %>
    <% if content %>
      <pre><%= content %></pre>
    <% else %>
      <%= html_colorize("Could not load file contents.") %>
    <% end %>
    <%= viewer_userfile_link(@userfile, :display => "(Show in a separate page)") if @page_type == :show %>
  <% else %>
    <%= viewer_userfile_link(@userfile, :display => "Show Displayable Content")%>
  <% end %>
<% end%>
